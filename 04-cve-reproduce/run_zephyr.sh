#!/bin/bash

DIR=$(dirname "$(realpath "${BASH_SOURCE[0]}")")

if [ -z "$QEMU_DIR" ]; then
    echo "[x] please set QEMU_DIR to QEMU directory"
    exit 1
fi

echo "[*] Executing Zephyr, the execution traces will be recorded in zephyr.log"
"$QEMU_DIR"/build/qemu-system-arm \
    -monitor null \
    -serial null \
    -nographic \
    -machine stm32f407 \
    -kernel "$DIR"/zephyr.elf \
    -chardev pipe,id=usart1,path="$DIR"/../1 \
    -s -S \
    -chardev stdio,id=usart2 &> "$DIR"/zephyr.log